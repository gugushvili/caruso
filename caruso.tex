\documentclass[]{tufte-handout}

% ams
\usepackage{amssymb,amsmath}

\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \makeatletter
  \@ifpackageloaded{fontspec}{}{\usepackage{fontspec}}
  \makeatother
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
  \makeatletter
  \@ifpackageloaded{soul}{
     \renewcommand\allcapsspacing[1]{{\addfontfeature{LetterSpace=15}#1}}
     \renewcommand\smallcapsspacing[1]{{\addfontfeature{LetterSpace=10}#1}}
   }{}
  \makeatother

\fi

% graphix
\usepackage{graphicx}
\setkeys{Gin}{width=\linewidth,totalheight=\textheight,keepaspectratio}

% booktabs
\usepackage{booktabs}

% url
\usepackage{url}

% hyperref
\usepackage{hyperref}

% units.
\usepackage{units}


\setcounter{secnumdepth}{-1}

% citations

% pandoc syntax highlighting
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\newenvironment{Shaded}{}{}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}

% longtable

% multiplecol
\usepackage{multicol}

% strikeout
\usepackage[normalem]{ulem}

% morefloats
\usepackage{morefloats}


% tightlist macro required by pandoc >= 1.14
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% title / author / date
\title{De-noising Caruso's recording}
\author{Shota Gugushvili}
\date{June 8, 2019}


\begin{document}

\maketitle




\subsection{Caruso's recording}\label{carusos-recording}

\href{https://en.wikipedia.org/wiki/Enrico_Caruso}{Enrico Caruso}
(1873--1921) was a famous Italian tenor, who sang to great acclaim in
major opera houses throughout the world. A good deal of his popularity
was due to numerous commercial audio recordings he made. Despite
primitive equipment of the time, Caruso's voice recorded extremely well,
and therein lay his advantage over many of his competitors. Plus, of
course, he was a consummate artist, and his was a truly exceptional
voice.

In this demonstration, I'll use an excerpt from Caruso's recording of
``E lucean le stelle'' (a tenor aria from Giacomo Puccini's opera
``Tosca'') to illustrate an amusing fact that residuals in the
(non-parametric) regression analysis can not only be \emph{displayed},
but also \emph{heard}.

\subsection{Data}\label{data}

First some preliminaries: I'll use the following \textbf{R} packages in
this document.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(waveslim)}
\KeywordTok{library}\NormalTok{(tuneR)}
\KeywordTok{library}\NormalTok{(EbayesThresh)}
\end{Highlighting}
\end{Shaded}

A digital signal of the aria (at the sampling rate 8192 Hz) is included
in
\href{http://statweb.stanford.edu/~wavelab/Wavelab_850/index_wavelab850.html}{WaveLab},
a free library of \textbf{Matlab} routines for wavelet analysis. No
further information on the recording is provided, but it can be surmised
that it was made sometime during the first decade of the 20th century.
\href{margin}{Throughout his career, Caruso recorded ``E lucean le
stelle'' several times. The piano accompaniment that we hear would fit
the following discs: Path√© from 1901 (matrix number 84004), Zonophone
from 1902 (matrix number X 1553), or Gramophone Typewriter from 1903
(matrix number 52349).} You can download the dataset
\href{caruso.txt}{here}. After loading the dataset, it can be visualised
as in the plot below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n <-}\StringTok{ }\DecValTok{48000}
\NormalTok{caruso <-}\StringTok{ }\KeywordTok{read.table}\NormalTok{(}\StringTok{"caruso.txt"}\NormalTok{)[}\DecValTok{1}\OperatorTok{:}\NormalTok{n,}\DecValTok{1}\NormalTok{]}
\KeywordTok{ggplot}\NormalTok{()}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =} \DecValTok{1}\OperatorTok{:}\NormalTok{n, }\DataTypeTok{y =}\NormalTok{ caruso)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{xlab}\NormalTok{(}\StringTok{"n"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\StringTok{"signal"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{marginfigure}
\includegraphics{caruso_files/figure-latex/unnamed-chunk-2-1} \end{marginfigure}

It's more enlightening to listen to the recording. In \textbf{R}, one
can either export the signal as a wave file (using the \textbf{tuneR}
package) and play it externally, or call a command line audio player
from within \textbf{R}. The code for the latter option is
platform-dependent, so I'll use the former, and let you do the manual
work.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{caruso_wave <-}\StringTok{ }\KeywordTok{Wave}\NormalTok{(caruso, }\DataTypeTok{samp.rate =} \DecValTok{8192}\NormalTok{, }\DataTypeTok{bit =} \DecValTok{16}\NormalTok{)}
\KeywordTok{writeWave}\NormalTok{(caruso_wave, }\DataTypeTok{filename =} \StringTok{"caruso.wav"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can now play the caruso.wav file on your computer. I've also linked
it \href{caruso.wav}{here}.

\subsection{De-noising}\label{de-noising}

Upon hearing the recording, presence of a substantial noise on top of
the signal becomes apparent. There're many cutting-edge audio de-noising
techniques, but since my primary goals are illustrative, I'll stick to
using the Discrete Wavelet Transform (DWT), see (Percival and Walden
2000). DWT is a special kind of a linear (orthogonal) transformation.
Loosely speaking, it has a property of concentrating most of the signal
in a few large components (coefficients), while spreading the original
noise ``uniformly'' in the transformed version. Wavelet approach to
de-noising consists in squashing ``small'' wavelet coefficients to zero,
since they hardly contain any signal whatsoever. I'll use the empirical
Bayes approach to wavelet de-noising, see (Johnstone and Silverman
2005b) and (Johnstone and Silverman 2005a). The latter method is
implemented in the \textbf{ebayesthresh} package.

The first step is to evaluate DWT; there are several options available,
but I'll use the \textbf{waveslim} package. I'll compute a (partial) DWT
with 2 levels of the transform. De-noising more than 2 levels appears to
be too invasive in the present setting.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{caruso_dwt <-}\StringTok{ }\KeywordTok{dwt}\NormalTok{(caruso, }\DataTypeTok{wf =} \StringTok{"la8"}\NormalTok{, }\DataTypeTok{n.levels =} \DecValTok{2}\NormalTok{, }\DataTypeTok{boundary =} \StringTok{"reflection"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The next step is to de-noise the DWT.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{EBayes <-}\StringTok{ }\KeywordTok{ebayesthresh.wavelet}\NormalTok{(caruso_dwt, }\DataTypeTok{threshrule =} \StringTok{"mean"}\NormalTok{, }\DataTypeTok{prior =} \StringTok{"laplace"}\NormalTok{, }\DataTypeTok{a =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{vscale =} \StringTok{"independent"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Now I'll invert the transform, and next round off the values to be able
to play the audio file.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{caruso_ebayes <-}\StringTok{ }\NormalTok{waveslim}\OperatorTok{::}\KeywordTok{idwt}\NormalTok{(EBayes)[}\DecValTok{1}\OperatorTok{:}\NormalTok{n] }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{round}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Finally, I'll create the wave file of the de-noised recording. It's also
available for download \href{caruso_ebayes.wav}{here}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{caruso_ebayes }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{Wave}\NormalTok{(}\DataTypeTok{samp.rate =} \DecValTok{8192}\NormalTok{, }\DataTypeTok{bit =} \DecValTok{16}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{writeWave}\NormalTok{(}\DataTypeTok{filename =} \StringTok{"caruso_ebayes.wav"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Listen to the file and judge it for yourself. To my ear, the results
aren't that brilliant: the original ``noisy'' version sounds more
natural! (play it again)

The truth is that DWT is not the most appropriate transform for audio
de-noising purposes. Perhaps the same should be said of the empirical
Bayes de-noising in (Johnstone and Silverman 2005b), as it wasn't
designed in view of audio de-noising applications, and hence doesn't
account for features important in that field; cf. (Wolfe, Godsill, and
Ng 2004) and (Godsill et al. 2007). This despite all kinds of nice
mathematical theorems established in (Johnstone and Silverman 2005b),
that deal with optimality properties of the empirical Bayes de-noising.

\subsection{Residuals}\label{residuals}

One can also judge the de-noising quality by examining the residuals
that resulted from the empirical Bayes method. These residuals can be
plotted, as in the figure below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{caruso_residuals <-}\StringTok{ }\NormalTok{caruso }\OperatorTok{-}\StringTok{ }\NormalTok{caruso_ebayes}
\KeywordTok{ggplot}\NormalTok{()}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =} \DecValTok{1}\OperatorTok{:}\NormalTok{n, }\DataTypeTok{y =}\NormalTok{ caruso_residuals)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{xlab}\NormalTok{(}\StringTok{"n"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\StringTok{"residuals"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{caruso_files/figure-latex/unnamed-chunk-8-1}

It looks like the method has removed quite some noise there, but let's
\emph{hear} the residuals. I have also placed the wave file
\href{caruso_residuals.wav}{here}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{caruso_residuals }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{Wave}\NormalTok{(}\DataTypeTok{samp.rate =} \DecValTok{8192}\NormalTok{, }\DataTypeTok{bit=}\DecValTok{16}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{writeWave}\NormalTok{(}\DataTypeTok{filename =} \StringTok{"caruso_residuals.wav"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

It turns out that when performing de-noising, the empirical Bayes has
chopped off a decent amount of the signal too: amidts the noise, one can
clearly distinguish Caruso's voice, though at a reduced volume! Now
subconsciously, a human brain is unlikely to accept such an outcome. One
possibility here is to use a multi-step method. That is, one can repeat
the whole procedure, but now applied on the residuals from the first
step. One may hope that thereby one will pile off another layer of the
signal and add it to the ``de-noised'' reconstruction from the first
step. This doesn't sound like a technique commonly considered in the
statistics literature when dealing with de-noising applications, though
it's been suggested elsewhere; see (Berger, Coifman, and Goldberg 1994).

And this brings the present illustrative example to completion. I hope
you enjoyed reading it!

\subsection*{References}\label{references}
\addcontentsline{toc}{subsection}{References}

\hypertarget{refs}{}
\hypertarget{ref-berger94}{}
Berger, Jonathan, Ronald R. Coifman, and Maxim J. Goldberg. 1994.
``Removing Noise from Music Using Local Trigonometric Bases and Wavelet
Packets.'' \emph{J. Audio Eng. Soc} 42 (10): 808--18.

\hypertarget{ref-godsill07}{}
Godsill, S. J., A. T. Cemgil, C. F√©votte, and P. J. Wolfe. 2007.
``Bayesian Computational Methods for Sparse Audio and Music
Processing.'' In \emph{15th European Signal Processing Conference
(EURASIP)}, 345--49.

\hypertarget{ref-JS05}{}
Johnstone, Iain M., and Bernard W. Silverman. 2005a. ``EbayesThresh: R
Programs for Empirical Bayes Thresholding.'' \emph{J. Stat. Softw.} 12
(8): 1--38.
doi:\href{https://doi.org/10.18637/jss.v012.i08}{10.18637/jss.v012.i08}.

\hypertarget{ref-johnstone05}{}
---------. 2005b. ``Empirical Bayes Selection of Wavelet Thresholds.''
\emph{Ann. Statist.} 33 (4): 1700--1752.
doi:\href{https://doi.org/10.1214/009053605000000345}{10.1214/009053605000000345}.

\hypertarget{ref-percival00}{}
Percival, Donald B., and Andrew T. Walden. 2000. \emph{Wavelet Methods
for Time Series Analysis}. Vol. 4. Cambridge Series in Statistical and
Probabilistic Mathematics. Cambridge University Press, Cambridge.
doi:\href{https://doi.org/10.1017/CBO9780511841040}{10.1017/CBO9780511841040}.

\hypertarget{ref-wolfe04}{}
Wolfe, Patrick J., Simon J. Godsill, and Wee-Jing Ng. 2004. ``Bayesian
Variable Selection and Regularization for Time-Frequency Surface
Estimation.'' \emph{J. R. Stat. Soc. Ser. B Stat. Methodol.} 66 (3):
575--89.
doi:\href{https://doi.org/10.1111/j.1467-9868.2004.02052.x}{10.1111/j.1467-9868.2004.02052.x}.



\end{document}
